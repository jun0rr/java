
{disecMicro}

# Insere registro na tabela de log do micro serviço
[insertLog]
  INSERT INTO disecMicro.log (
    ip, url, context, uri, cd_usu, uor_depe, uor_eqp, autd
  ) VALUES (
    ?, ?, ?, ?, 'F0000000', 0, 0, '1'
  );

# Procura a query no banco de dados do micro serviço
[findQuery]
  SELECT `sql` FROM disecMicro.sqls
  WHERE name = ? AND enabled = 1;


{auth}

# Busca informações do Usuário no Banco de Dados
[selectUser]
  select u.CD_USU, 
      u.NM_USU,
      u.NM_ABVD,
      p.NR_TCEL,
      concat(u.CD_USU, ' ', u.NM_USU) as chaveNome,
      u.CD_CMSS,
      u.CD_IOR,
      d.CD_PILAR,
      p.TX_CMSS_FUN,
      p.NR_CPF,
      p.CD_EMAI_BB,
      p.CD_CLI,
      d.CD_PRF,
      (	select CD_PRF from mstNovo.depe 
        where CD_UOR = mstNovo.diretoria(u.CD_UOR_LCLZ)
      ) as prfDiretoria,
      e.SG_UF,
      p.CD_TEL_TRB,
      d.CD_TIP_UOR,
      u.CD_UOR_LCLZ,
      u.CD_UOR_EQP
  from arhNovo.tb_usu as u
  left join arh.dado_pss as p
    on p.CD_USU = u.CD_USU
  inner join mstNovo.depe as d
    on d.CD_UOR = u.CD_UOR_LCLZ
  left join mstNovo.depe_end as e
    on e.CD_UOR = d.CD_UOR
  where u.CD_USU = ?
  limit 1;
